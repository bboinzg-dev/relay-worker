substitutions:
  _SERVICE: worker
  _REGION: asia-northeast3
  _REPO: worker
  _IMAGE: relay-worker

steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build','-t','asia-northeast3-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_IMAGE}:$SHORT_SHA','.']

- name: 'gcr.io/cloud-builders/docker'
  args: ['push','asia-northeast3-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_IMAGE}:$SHORT_SHA']

- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: ['run','deploy','${_SERVICE}',
         '--image=asia-northeast3-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_IMAGE}:$SHORT_SHA',
         '--region=${_REGION}','--platform=managed','--quiet']
images:
- asia-northeast3-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_IMAGE}:$SHORT_SHA
