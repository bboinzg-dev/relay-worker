diff --git a/docai_smoke.js b/docai_smoke.js
index 8a9b817a6d8f609e81ba00bf3beb5018902e387c..0dbaf5e3de812a03bb203aa7afc35c1d5d8521c6 100644
--- a/docai_smoke.js
+++ b/docai_smoke.js
@@ -1,20 +1,43 @@
-const { batchProcess } = require('./docai_client');
-const { extractRelayFields } = require('./docai_parse');
+'use strict';
+
 const { Storage } = require('@google-cloud/storage');
+const { batchProcess, extractRelayFields } = require('./src/utils/docai');
 const { safeJsonParse } = require('./src/utils/safe-json');
+
 const storage = new Storage();
-function parseGs(gs){ const s=gs.replace('gs://',''); const i=s.indexOf('/'); return {bucket:s.slice(0,i), name:s.slice(i+1)}; }
-(async ()=>{
-  try{
+
+function parseGs(gsUri) {
+  const stripped = String(gsUri).replace('gs://', '');
+  const idx = stripped.indexOf('/');
+  return { bucket: stripped.slice(0, idx), name: stripped.slice(idx + 1) };
+}
+
+(async () => {
+  try {
     const input = process.argv[2];
-    if(!input){ console.error('Usage: node docai_smoke.js gs://bucket/file.pdf'); process.exit(1); }
-    const outPrefix = `gs://${process.env.GCS_BUCKET_DOCAI || 'partsplan-473810-docai-us'}/out/${Date.now()}/`;
+    if (!input) {
+      console.error('Usage: node docai_smoke.js gs://bucket/file.pdf');
+      process.exit(1);
+    }
+
+    const bucket = process.env.GCS_BUCKET_DOCAI || 'partsplan-473810-docai-us';
+    const outPrefix = `gs://${bucket}/out/${Date.now()}/`;
+
     const { outputs } = await batchProcess(input, outPrefix);
     console.log('DocAI outputs:', outputs);
-    const first = outputs.find(u => u.endsWith('.json'));
-    const {bucket,name} = parseGs(first);
-    const [buf] = await storage.bucket(bucket).file(name).download();
+
+    const first = outputs.find((uri) => uri.endsWith('.json'));
+    if (!first) {
+      console.error('No JSON outputs found');
+      process.exit(3);
+    }
+
+    const { bucket: outBucket, name } = parseGs(first);
+    const [buf] = await storage.bucket(outBucket).file(name).download();
     const doc = safeJsonParse(buf.toString('utf8'));
     console.log('Extracted:', extractRelayFields(doc));
-  } catch(e){ console.error(e); process.exit(2); }
+  } catch (err) {
+    console.error(err);
+    process.exit(2);
+  }
 })();
